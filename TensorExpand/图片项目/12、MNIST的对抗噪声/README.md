参考：

- 1、[TensorFlow 教程 #12 - MNIST的对抗噪声](https://zhuanlan.zhihu.com/p/27399023)
- 2、[Hvass-Labs/TensorFlow-Tutorials](https://github.com/Hvass-Labs/TensorFlow-Tutorials)
- 3、[thrillerist/TensorFlow-Tutorials](https://github.com/thrillerist/TensorFlow-Tutorials)


----------
教程#11是通过每张图像的优化过程来寻找对抗噪声的。由于噪声是专门为某张图像生成，因此它可能不是通用的，无法在其他图像上起作用。

本教程将会找到那些导致**几乎所有输入图像**都被误分类成目标类别的对抗噪声。我们使用MNIST手写数字数据集为例。现在，对抗噪声对人眼是清晰可见的，但人类还是能够很容易地辨认出数字，然而神经网络几乎将所有图像误分类。

这篇教程里，我们还会试着让神经网络对对抗噪声免疫。

教程 #11 用Numpy来做对抗优化。在这篇教程里，我们会直接在TensorFlow里实现优化过程。这会更快速，尤其是在使用GPU的时候，因为不用每次迭代都在GPU里拷贝数据。

推荐你先学习教程 #11。你也需要大概地熟悉神经网络，详见教程 #01和 #02。


# 流程图

![这里写图片描述](https://github.com/fengzhongyouxia/TensorExpand/blob/master/TensorExpand/%E5%9B%BE%E7%89%87%E9%A1%B9%E7%9B%AE/12%E3%80%81MNIST%E7%9A%84%E5%AF%B9%E6%8A%97%E5%99%AA%E5%A3%B0/MNIST%E7%9A%84%E5%AF%B9%E6%8A%97%E5%99%AA%E5%A3%B0.png)

下面的图表直接展示了之后实现的卷积神经网络中数据的传递。

例子展示的是数字7的输入图像。随后在图像上添加对抗噪声。红色的噪声点是正值，它让像素值更深，蓝色噪声点是负值，让输入图像在此处的颜色更浅。

这些噪声图像传到神经网络中，然后得到一个预测数字。这种情况下，对抗噪声让神经网络相信这张数字7的图像显示的是数字3。噪声对人眼是清晰可见的，但人类仍然可以容易地辨认出数字7来。

这边值得注意的是，单一的噪声模式会导致神经网络将几乎所有的输入图像都误分类成期望的目标类型。

在这个神经网络中有**两个单独的优化程序**。首先，我们优化神经网络的变量来分类训练集的图像。这是神经网络的常规优化过程。一旦分类准确率足够高，我们就切换到第二个优化程序，（它用来）寻找单一模式的对抗噪声，使得所有的输入图像都被误分类成目标类型。

这两个优化程序是**完全独立**的。第一个程序只修改量神经网络的变量，第二个程序只修改对抗噪声。

![这里写图片描述](https://pic2.zhimg.com/80/v2-a97cea47c330e98be6d2e5c723dfa895_hd.jpg)

# 讨论
在上面的实验中可以看到，我们能够使神经网络对单个目标类别的对抗噪声免疫。这使得不可能找到引起误分类到目标类型的对抗噪声。但是，显然也不可能使神经网络同时对所有目标类别免疫。可能用其他方法能够做到这一点。

一种建议是对不同目标类型进行交叉的免疫训练，而不是依次对每个目标类型进行完全的优化。对上面的代码做些小修改就能做到这一点。

另一个建议是设置两层神经网络，共11个网络。第一层网络用来对输入图像进行分类。这个网络没有对对抗噪声免疫。然后根据第一层的预测类型选择第二层的另一个网络。第二层中的网络对各自目标类型的对抗噪声免疫。因此，一个对抗样本可能糊弄第一层的网络，但第二层中的网络会免于特定目标类型噪声的影响。

这可能使用了类型数量比较少的情况，但如果数量很大就变得不可行，比如ImageNet有1000个类别，这样我们在第二层中需要训练1000个神经网络，这并不实际。

# 总结
这篇教程展示了如何找到MNIST数据集手写数字的对抗噪声。 每个目标类别都找到了一个单一的噪声模式，它导致几乎所有的输入图像都被误分类为目标类别。

MNIST数据集的噪声模式对人眼清晰可见。但可能在高分辨率图像上（比如ImageNet数据集）工作的大型神经网络可以找到更细微的噪声模式。

本教程也尝试了使神经网络免受对抗噪声影响的方法。 这对单个目标类别有效，但所测试的方法无法使神经网络同时对所有对抗目标类别免疫。

# 练习
下面使一些可能会让你提升TensorFlow技能的一些建议练习。为了学习如何更合适地使用TensorFlow，实践经验是很重要的。

在你对这个Notebook进行修改之前，可能需要先备份一下。

- 尝试为对抗噪声使用更少或更多的优化迭代数。
- 教程#11只需少于30次的迭代次数就能找到对抗噪声，相比之下为什么这篇教程需要更多迭代？
- 尝试设置不同的noise_limit 和 noise_l2_weight。这会如何影响对抗噪声以及分类准确率？
- 试着为目标类型1寻找对抗噪声。它是否适用于目标类型3？
- 你能找到一个更好的方法，使得神经网络对对抗噪声免疫吗？
- 神经网络是否可以对单个图像产生的对抗噪声免疫，就像教程 #11 中所做的那样？
- 尝试用不同的配置创建另一个神经网络。一个网络上的对抗噪声对另一个网络有效吗？
- 用CIFAR-10数据集代替MNIST。你可以复用教程 #06 中的一些代码。
- 你会如何找到Inception模型和ImageNet数据集的对抗噪声？
- 向朋友解释程序如何工作。
