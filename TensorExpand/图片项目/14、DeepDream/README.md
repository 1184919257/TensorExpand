参考：

- 1、[TensorFlow 教程 #14 - DeepDream](https://zhuanlan.zhihu.com/p/27546601)
- 2、[Hvass-Labs/TensorFlow-Tutorials](https://github.com/Hvass-Labs/TensorFlow-Tutorials)


----------
# 介绍
在上一篇教程中，我们看到了如何用神经网络的梯度来生成图像。教程#11和#12展示了如何用梯度来生成对抗噪声。教程#13展示了怎么用梯度来生成神经网络内部特征所响应的图像。

本文会使用一个与之前类似的方法。现在我们会用**神经网络的梯度来放大输入图像中的图案**（patterns）。这个通常称为**DeepDream算法**，但这个技术实际上有许多不同的变体。

本文基于之前的教程。你需要大概地熟悉神经网络（详见教程 #01和 #02）。
# 流程图

下面的流程图粗略展示了DeepDream算法的想法。我们使用的是Inception模型，它的层次要比这边显示的更多。**我们使用TensorFlow自动导出网络中一个给定层相对于输入图像的梯度。然后用梯度来更新输入图像。这个过程重复多次，直到出现图案并且我们对所得到的图像满意为止。**

这里的原理就是，**神经网络在图像中看到一些图案的痕迹，然后我们只是用梯度把它放大了**。

这里没有显示DeepDream算法的一些细节，例如梯度被平滑了，后面会讨论它的一些优点。**梯度也是分块计算**的，因此它可以在高分辨率的图像上工作，而不会耗尽计算机内存。

![这里写图片描述](https://pic2.zhimg.com/80/v2-1a73209aa0f047477b90a32d1bf0eaec_hd.jpg)

# 递归优化
Inception模型是在相当低分辨率的图像上进行训练的，大概200-300像素。所以，当我们使用更大分辨率的图像时，DeepDream算法会在图像中创建许多小的图案。

**一个解决方案**是将输入图像缩小到200-300像素。但是这么低的分辨率（的结果）是像素化而且丑陋的。

**另一个解决方案**是多次缩小原始图像，在每个较小的图像上运行DeepDream算法。这样会在图像中创建更大的图案，然后以更高的分辨率进行改善。

这个流程图粗略显示了这个想法。算法递归地实现并且支持任何数量的缩小级别。算法有些细节并未在这里展示，比如，图像在缩小之前会做一些模糊处理，并且原始图像只是与DeepDream图像混合在一起，来增加一些原始的细节。

![这里写图片描述](https://pic4.zhimg.com/80/v2-c3e7d90ccb0abf0a6ce88042718b7620_hd.jpg)

# 总结

这篇教程展示了如何**使用神经网络的梯度来放大图像中的图案**。输出图像似乎已经用抽象的或类似动物的图案来重新绘制了。

还有许多这种技术的变体，来生成不同的输出图像。我们鼓励你修改上述参数和算法进行实验。

# 练习

下面使一些可能会让你提升TensorFlow技能的一些建议练习。为了学习如何更合适地使用TensorFlow，实践经验是很重要的。

在你对这个Notebook进行修改之前，可能需要先备份一下。

- 尝试使用自己的图像。
- 试试optimize_image()和recursive_optimize()的不同参数，看看它如何影响结果。
- 试着去掉optimize_image()中的梯度。会发生什么？
- 在运行optimize_image()时绘制梯度。会看到一些失真吗？你认为是什么原因？这重要吗？你能找到一种方法来去掉它们吗？
- 尝试使用随机噪声作为输入图像。这与教程＃13中用于可视化分析的类似。会生成比本教程中更好的图像吗？为什么？
- 在inception5h.py这个文件的Inception5h.get_gradient()里，删除tf.square()。 DeepDream图像会发生什么变化？为什么？
- 你可以将梯度移到optimize_image()外面以节省内存吗？
- 你能使程序运行得更快吗？一个想法是直接在TensorFlow中实现高斯模糊和调整大小。
- 通过重复调用optimize_image()并在图像上放大一点，制作一个DeepDream电影。
- 逐帧处理电影。您可能需要在帧间保持稳定。
- 向朋友解释程序如何工作。
